<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>EduHack-AI-4 - Attendee Frame</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Arial', sans-serif;
        background: #0a0e27;
        min-height: 100vh;
        padding: 20px;
        touch-action: pan-y;
        overflow-x: hidden;
    }

    .bg-pattern {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 50%, #0f1229 100%);
        z-index: 0;
    }

    .particle {
        position: fixed;
        background: radial-gradient(circle, rgba(138, 43, 226, 0.2) 0%, transparent 70%);
        border-radius: 50%;
        animation: float 20s infinite;
        pointer-events: none;
    }

    @keyframes float {
        0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.3; }
        33% { transform: translate(50px, -50px) scale(1.2); opacity: 0.5; }
        66% { transform: translate(-30px, 30px) scale(0.8); opacity: 0.3; }
    }

    .header {
        background: #161b2b;
        backdrop-filter: blur(10px);
        padding: 15px 20px;
        box-shadow: 0 4px 30px rgba(138, 43, 226, 0.2);
        position: relative;
        z-index: 10;
        border-bottom: 2px solid rgba(138, 43, 226, 0.3);
        border-radius: 15px;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 15px;
    }

    .header-logo {
        width: 150px;
        height: 150px;
        object-fit: contain;
        flex-shrink: 0;
    }

    .header-content {
        text-align: center;
        flex: 1;
    }

    .header h1 {
        font-size: clamp(1.2em, 4vw, 2.2em);
        background: linear-gradient(135deg, #00d9ff, #ec4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0;
    }

    .header p {
        color: rgba(255,255,255,0.9);
        margin-top: 5px;
        font-size: clamp(0.8em, 2.5vw, 1.1em);
    }

    .header-spacer {
        width: 150px;
        flex-shrink: 0;
    }

    .main-container {
        max-width: 1600px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
        position: relative;
        z-index: 10;
    }

    .form-section {
        background: rgba(26, 29, 58, 0.8);
        backdrop-filter: blur(20px);
        padding: 25px;
        border-radius: 24px;
        box-shadow: 0 10px 40px rgba(138, 43, 226, 0.3);
        border: 1px solid rgba(138, 43, 226, 0.3);
    }

    .preview-section {
        background: rgba(26, 29, 58, 0.8);
        backdrop-filter: blur(20px);
        padding: 25px;
        border-radius: 24px;
        box-shadow: 0 10px 40px rgba(236, 72, 153, 0.3);
        border: 1px solid rgba(236, 72, 153, 0.3);
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        color: #00d9ff;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: clamp(0.8em, 2.5vw, 0.9em);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-group input, .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid rgba(138, 43, 226, 0.3);
        border-radius: 12px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: rgba(10, 14, 39, 0.6);
        color: white;
    }

    .form-group input::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    .form-group input:focus, .form-group select:focus {
        outline: none;
        border-color: #8a2be2;
        background: rgba(10, 14, 39, 0.9);
        box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
    }

    .upload-area {
        border: 3px dashed #8a2be2;
        border-radius: 15px;
        padding: 25px 15px;
        text-align: center;
        background: rgba(138, 43, 226, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .upload-area:hover {
        background: rgba(138, 43, 226, 0.2);
        border-color: #ec4899;
        transform: translateY(-2px);
    }

    .upload-area p {
        color: #00d9ff;
        font-weight: 600;
        margin-bottom: 5px;
        font-size: clamp(0.85em, 2.5vw, 1.1em);
    }

    .section-title {
        color: #ec4899;
        font-size: clamp(1em, 3vw, 1.2em);
        font-weight: bold;
        margin: 25px 0 15px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(236, 72, 153, 0.3);
    }

    .frame-preview {
        width: 100%;
        max-width: 100%;
        margin: 0 auto 20px;
        position: relative;
    }

    .badge-container {
        position: relative;
        width: 100%;
        padding-bottom: 59.38%;
        background: #1a1a1a;
        border-radius: 10px;
        overflow: hidden;
    }

    .frame-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
        pointer-events: none;
    }

    .badge-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 5;
    }

    .photo-circle {
        position: absolute;
        width: 36%;
        height: 60.5%;
        top: 19.5%;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 50%;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
    }

    .photo-inner {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: #1a1a1a;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .photo-canvas {
        border-radius: 50%;
        cursor: grab;
        width: 100%;
        height: 100%;
        touch-action: none;
    }

    .photo-canvas:active {
        cursor: grabbing;
    }

    .placeholder {
        color: #555;
        font-size: clamp(2em, 6vw, 3em);
        pointer-events: none;
    }

    .user-info-item {
        position: absolute;
        z-index: 15;
        color: transparent;
        word-wrap: break-word;
        line-height: 1.3;
        font-weight: 600;
        font-family: 'Georgia', 'Times New Roman', Times, serif;
        text-align: left;
        pointer-events: none;
        letter-spacing: 0.3px;
    }

    .controls {
        margin-top: 20px;
        display: none;
    }

    .controls.active {
        display: block;
    }

    .controls label {
        display: block;
        color: #00d9ff;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: clamp(0.85em, 2.5vw, 1em);
    }

    input[type="range"] {
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: rgba(138, 43, 226, 0.3);
        outline: none;
        -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8a2be2, #ec4899);
        cursor: pointer;
        box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
    }

    input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8a2be2, #ec4899);
        cursor: pointer;
        box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        border: none;
    }

    .action-buttons {
        display: none;
        flex-direction: column;
        gap: 12px;
        margin-top: 20px;
    }

    .action-buttons.active {
        display: flex;
    }

    .btn {
        padding: 14px 24px;
        border: none;
        border-radius: 12px;
        font-size: clamp(13px, 2.5vw, 16px);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        text-decoration: none;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(138, 43, 226, 0.4);
    }

    .btn-download {
        background: linear-gradient(135deg, #8a2be2, #ec4899);
        color: white;
    }

    .btn-linkedin {
        background: linear-gradient(135deg, #0077b5, #00a0dc);
        color: white;
    }

    .caption-container {
        display: none;
        background: rgba(0, 217, 255, 0.1);
        border: 2px solid rgba(0, 217, 255, 0.3);
        border-radius: 12px;
        padding: 15px;
        margin-top: 15px;
    }

    .caption-container.active {
        display: block;
    }

    .caption-title {
        color: #00d9ff;
        font-weight: 600;
        font-size: clamp(0.85em, 2.5vw, 1em);
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .caption-text {
        background: rgba(10, 14, 39, 0.6);
        border: 1px solid rgba(138, 43, 226, 0.3);
        border-radius: 8px;
        padding: 12px;
        color: rgba(255, 255, 255, 0.9);
        font-size: clamp(0.8em, 2.5vw, 0.95em);
        line-height: 1.6;
        margin-bottom: 10px;
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    .btn-copy-caption {
        background: linear-gradient(135deg, #00d9ff, #8a2be2);
        color: white;
        width: 100%;
    }

    .hint {
        text-align: center;
        color: rgba(255, 255, 255, 0.6);
        font-size: clamp(0.7em, 2vw, 0.85em);
        margin-top: 10px;
        font-style: italic;
    }

    @media (min-width: 1024px) {
        .main-container {
            grid-template-columns: 1fr 1.2fr;
            gap: 40px;
        }

        .preview-section {
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .action-buttons {
            flex-direction: row;
        }

        .header-logo {
            width: 120px;
            height: 120px;
        }

        .header-spacer {
            width: 120px;
        }

        .header {
            padding: 20px;
        }
    }

    @media (max-width: 1023px) {
        body {
            padding: 10px;
        }

        .header {
            padding: 12px 15px;
            margin-bottom: 20px;
        }

        .form-section, .preview-section {
            padding: 20px;
        }

        .section-title {
            margin: 20px 0 12px 0;
        }
    }

    @media (max-width: 480px) {
        body {
            padding: 8px;
        }

        .header {
            padding: 10px;
            gap: 10px;
        }

        .header-logo {
            width: 100px;
            height: 100px;
        }

        .header-spacer {
            width: 80px;
        }

        .form-section, .preview-section {
            padding: 15px;
            border-radius: 18px;
        }

        .upload-area {
            padding: 20px 10px;
        }

        .user-info-item {
            padding: 6px;
        }
    }
</style>
</head>
<body>

<div class="bg-pattern"></div>

<script>
    for(let i = 0; i < 15; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        const size = Math.random() * 150 + 50;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (Math.random() * 15 + 15) + 's';
        document.body.appendChild(particle);
    }
</script>

<div class="header">
    <img src="logo.png" alt="Sahaba Club Logo" class="header-logo">
    <div class="header-content">
        <h1>EduHack-AI-4 Attendee Frame Generator</h1>
        <p>Made by Sahaba Club</p>
    </div>
    <div class="header-spacer"></div>
</div>

<div class="main-container">
    <div class="form-section">
        <div class="section-title">üìù User Information</div>
        
        <div class="form-group">
            <label>FULL NAME</label>
            <input type="text" id="fullName" placeholder="Enter your full name">
        </div>

        <div class="form-group">
            <label>STUDENT OR WORKING</label>
            <input type="text" id="jobTitle" placeholder="e.g., Student, Software Engineer">
        </div>

        <div class="form-group">
            <label>COMPANY OR UNIVERSITY</label>
            <input type="text" id="company" placeholder="Enter your institution">
        </div>

        <div class="form-group">
            <label>PROFILE PHOTO</label>
            <div class="upload-area" onclick="document.getElementById('upload').click()">
                <p>üì∏ CLICK TO UPLOAD YOUR PHOTO</p>
                <small style="color: rgba(255,255,255,0.6); font-size: clamp(0.7em, 2vw, 0.9em);">Square format recommended</small>
            </div>
            <input type="file" id="upload" accept="image/*" style="display:none;">
        </div>
    </div>

    <div class="preview-section">
        <div class="frame-preview">
            <div class="badge-container" id="badgeContainer">
                <img src="frame.jpg" alt="Badge Frame" class="frame-image">
                <div class="badge-content">
                    <div class="photo-circle">
                        <div class="photo-inner">
                            <canvas id="canvas" class="photo-canvas" width="400" height="400"></canvas>
                            <div class="placeholder" id="placeholder">üë§</div>
                        </div>
                    </div>
                    <div class="user-info-item" id="nameOverlay" style="top: 36.4%; left: 68.4%; width: 28%; font-size: 28px;">Your Name</div>
                    <div class="user-info-item" id="jobOverlay" style="top: 47.6%; left: 68.4%; width: 28%; font-size: 22px;">Student/Working</div>
                    <div class="user-info-item" id="companyOverlay" style="top: 57.8%; left: 68.4%; width: 28%; font-size: 22px;">Your Institution</div>
                </div>
            </div>
        </div>

        <div class="controls" id="controls">
            <label>üîç Zoom: <span id="zoomValue">100%</span></label>
            <input type="range" id="zoomSlider" min="50" max="300" value="100">
            <p class="hint">üí° Drag the photo to position it perfectly</p>
        </div>

        <div class="action-buttons" id="actionButtons">
            <button class="btn btn-download" id="downloadBtn">
                üì• Download Badge
            </button>
            <button class="btn btn-linkedin" id="linkedinBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/>
                </svg>
                Share on LinkedIn
            </button>
        </div>

        <div class="caption-container" id="captionContainer">
            <div class="caption-title">üìù LinkedIn Caption</div>
            <div class="caption-text" id="captionText">üéâ Excited to announce that I attended EduHack-AI-4! üöÄ

A fantastic experience exploring the intersection of education and artificial intelligence with brilliant minds and innovative ideas.

Thank you to Sahaba Club for organizing this amazing event! üôè

#EduHackAI4 #SahabaClub #AI #Education #Innovation #TechEvent</div>
            <button class="btn btn-copy-caption" id="copyCaptionBtn">
                üìã Copy Caption
            </button>
        </div>
    </div>
</div>

<script>
const uploadInput = document.getElementById("upload");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const placeholder = document.getElementById("placeholder");
const zoomSlider = document.getElementById("zoomSlider");
const zoomValue = document.getElementById("zoomValue");
const controlsDiv = document.getElementById("controls");
const actionButtons = document.getElementById("actionButtons");
const downloadBtn = document.getElementById("downloadBtn");
const linkedinBtn = document.getElementById("linkedinBtn");
const captionContainer = document.getElementById("captionContainer");
const copyCaptionBtn = document.getElementById("copyCaptionBtn");
const captionText = document.getElementById("captionText");

const fullNameInput = document.getElementById("fullName");
const jobTitleInput = document.getElementById("jobTitle");
const companyInput = document.getElementById("company");
const nameOverlay = document.getElementById("nameOverlay");
const jobOverlay = document.getElementById("jobOverlay");
const companyOverlay = document.getElementById("companyOverlay");

let uploadedImage = null;
let imageScale = 1;
let imageX = 0;
let imageY = 0;
let isDragging = false;
let lastMouseX = 0;
let lastMouseY = 0;

function calculateDynamicFontSize(text, baseSize) {
    const length = text.length;
    if (length <= 18) return baseSize;
    if (length <= 30) return baseSize * 0.9;
    if (length <= 40) return baseSize * 0.8;
    return baseSize * 0.7;
}

fullNameInput.addEventListener("input", function() {
    const text = this.value || "Your Name";
    nameOverlay.textContent = text;
    const fontSize = calculateDynamicFontSize(text, 28);
    nameOverlay.style.fontSize = fontSize + 'px';
});

jobTitleInput.addEventListener("input", function() {
    const text = this.value || "Student/Working";
    jobOverlay.textContent = text;
    const fontSize = calculateDynamicFontSize(text, 22);
    jobOverlay.style.fontSize = fontSize + 'px';
});

companyInput.addEventListener("input", function() {
    const text = this.value || "Your Institution";
    companyOverlay.textContent = text;
    const fontSize = calculateDynamicFontSize(text, 22);
    companyOverlay.style.fontSize = fontSize + 'px';
});

copyCaptionBtn.addEventListener('click', function() {
    const caption = captionText.textContent;
    
    navigator.clipboard.writeText(caption).then(() => {
        const originalText = this.innerHTML;
        this.innerHTML = '‚úÖ Caption Copied!';
        setTimeout(() => {
            this.innerHTML = originalText;
        }, 2000);
    }).catch(() => {
        const textArea = document.createElement('textarea');
        textArea.value = caption;
        textArea.style.position = 'fixed';
        textArea.style.left = '-9999px';
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            const originalText = this.innerHTML;
            this.innerHTML = '‚úÖ Caption Copied!';
            setTimeout(() => {
                this.innerHTML = originalText;
            }, 2000);
        } catch (err) {
            alert('Failed to copy caption. Please copy manually.');
        }
        document.body.removeChild(textArea);
    });
});

uploadInput.addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.onload = function() {
        uploadedImage = img;
        imageScale = 1;
        imageX = 0;
        imageY = 0;
        zoomSlider.value = 100;
        
        drawImage();
        placeholder.style.display = 'none';
        controlsDiv.classList.add('active');
        actionButtons.classList.add('active');
        captionContainer.classList.add('active');
    };
    img.src = URL.createObjectURL(file);
});

zoomSlider.addEventListener("input", function() {
    imageScale = this.value / 100;
    zoomValue.textContent = this.value + '%';
    drawImage();
});

canvas.addEventListener('mousedown', function(e) {
    if (!uploadedImage) return;
    isDragging = true;
    const rect = canvas.getBoundingClientRect();
    lastMouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
    lastMouseY = (e.clientY - rect.top) * (canvas.height / rect.height);
});

canvas.addEventListener('mousemove', function(e) {
    if (!isDragging || !uploadedImage) return;
    
    const rect = canvas.getBoundingClientRect();
    const mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
    const mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);
    
    imageX += mouseX - lastMouseX;
    imageY += mouseY - lastMouseY;
    
    lastMouseX = mouseX;
    lastMouseY = mouseY;
    
    drawImage();
});

canvas.addEventListener('mouseup', () => isDragging = false);
canvas.addEventListener('mouseleave', () => isDragging = false);

canvas.addEventListener('touchstart', function(e) {
    if (!uploadedImage) return;
    e.preventDefault();
    isDragging = true;
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    lastMouseX = (touch.clientX - rect.left) * (canvas.width / rect.width);
    lastMouseY = (touch.clientY - rect.top) * (canvas.height / rect.height);
});

canvas.addEventListener('touchmove', function(e) {
    if (!isDragging || !uploadedImage) return;
    e.preventDefault();
    
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    const touchX = (touch.clientX - rect.left) * (canvas.width / rect.width);
    const touchY = (touch.clientY - rect.top) * (canvas.height / rect.height);
    
    imageX += touchX - lastMouseX;
    imageY += touchY - lastMouseY;
    
    lastMouseX = touchX;
    lastMouseY = touchY;
    
    drawImage();
});

canvas.addEventListener('touchend', () => isDragging = false);

function drawImage() {
    if (!uploadedImage) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2, 0, Math.PI * 2);
    ctx.closePath();
    ctx.clip();

    const imgWidth = uploadedImage.width;
    const imgHeight = uploadedImage.height;
    const canvasSize = canvas.width;
    
    let drawWidth, drawHeight;
    
    if (imgWidth > imgHeight) {
        drawHeight = canvasSize * imageScale;
        drawWidth = (imgWidth / imgHeight) * drawHeight;
    } else {
        drawWidth = canvasSize * imageScale;
        drawHeight = (imgHeight / imgWidth) * drawWidth;
    }
    
    const offsetX = (canvasSize - drawWidth) / 2 + imageX;
    const offsetY = (canvasSize - drawHeight) / 2 + imageY;

    ctx.drawImage(uploadedImage, 0, 0, imgWidth, imgHeight, offsetX, offsetY, drawWidth, drawHeight);
    ctx.restore();
}

linkedinBtn.addEventListener("click", function(e) {
    e.preventDefault();
    
    if (!uploadedImage) {
        alert('Please upload a photo first!');
        return;
    }

    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isAndroid = /Android/.test(navigator.userAgent);
    
    if (isIOS) {
        window.location.href = 'linkedin://';
        
        setTimeout(() => {
            window.open('https://www.linkedin.com/feed/', '_blank');
        }, 2500);
        
        setTimeout(() => {
            alert('üì∏ Upload your downloaded badge when creating your LinkedIn post!\n\nüí° Tip: Use the "Copy Caption" button below to get the caption text.');
        }, 3000);
    } else if (isAndroid) {
        const linkedinAppUrl = 'linkedin://';
        const linkedinWebUrl = 'https://www.linkedin.com/feed/';
        
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = linkedinAppUrl;
        document.body.appendChild(iframe);
        
        setTimeout(() => {
            document.body.removeChild(iframe);
            window.open(linkedinWebUrl, '_blank');
        }, 2000);
        
        setTimeout(() => {
            alert('üì∏ Upload your downloaded badge when creating your LinkedIn post!\n\nüí° Tip: Use the "Copy Caption" button below to get the caption text.');
        }, 2500);
    } else {
        window.open('https://www.linkedin.com/feed/?shareActive=true', '_blank', 'noopener,noreferrer');
        alert('üì∏ Please upload your downloaded badge and use the caption below when sharing on LinkedIn!');
    }
});

downloadBtn.addEventListener("click", function() {
    if (!uploadedImage) {
        alert('Please upload a photo first!');
        return;
    }

    const frameImg = new Image();
    frameImg.crossOrigin = "anonymous";
    
    frameImg.onload = function() {
        const finalCanvas = document.createElement('canvas');
        finalCanvas.width = 1280;
        finalCanvas.height = 760;
        const finalCtx = finalCanvas.getContext('2d');

        finalCtx.drawImage(frameImg, 0, 0, 1280, 760);

        finalCtx.save();
        
        const circleX = 640;
        const circleY = 380;
        const circleRadius = 230;
        
        finalCtx.beginPath();
        finalCtx.arc(circleX, circleY, circleRadius, 0, Math.PI * 2);
        finalCtx.closePath();
        finalCtx.clip();

        const scale = (circleRadius * 2) / 400;
        const imgW = uploadedImage.width;
        const imgH = uploadedImage.height;
        
        let drawWidth, drawHeight;
        if (imgW > imgH) {
            drawHeight = 400 * imageScale * scale;
            drawWidth = (imgW / imgH) * drawHeight;
        } else {
            drawWidth = 400 * imageScale * scale;
            drawHeight = (imgH / imgW) * drawWidth;
        }
        
        const offsetX = circleX - drawWidth/2 + (imageX * scale);
        const offsetY = circleY - drawHeight/2 + (imageY * scale);

        finalCtx.drawImage(uploadedImage, 0, 0, imgW, imgH, offsetX, offsetY, drawWidth, drawHeight);
        finalCtx.restore();

        finalCtx.fillStyle = 'white';
        finalCtx.shadowColor = 'rgba(0, 0, 0, 0.9)';
        finalCtx.shadowBlur = 6;
        finalCtx.shadowOffsetX = 2;
        finalCtx.shadowOffsetY = 2;
        finalCtx.textAlign = 'left';
        
        const nameTopPercent = 36.4;
        const nameLeftPercent = 72.4;
        
        const nameX = 1280 * (nameLeftPercent / 100);
        const nameY = 760 * (nameTopPercent / 100);
        const nameMaxWidth = 1280 * 0.28;
        
        const nameText = fullNameInput.value.trim() || 'Your Name';
        const nameFontSize = calculateDynamicFontSize(nameText, 28);
        finalCtx.font = `600 ${nameFontSize}px 'Georgia', 'Times New Roman', Times, serif`;
        wrapTextLeft(finalCtx, nameText, nameX, nameY, nameMaxWidth, nameFontSize * 1.3, 3);

        const jobTopPercent = 47.6;
        const jobLeftPercent = 72.4;
        
        const jobX = 1280 * (jobLeftPercent / 100);
        const jobY = 760 * (jobTopPercent / 100);
        const jobMaxWidth = 1280 * 0.28;
        
        const jobText = jobTitleInput.value.trim() || 'Student/Working';
        const jobFontSize = calculateDynamicFontSize(jobText, 22);
        finalCtx.font = `600 ${jobFontSize}px 'Georgia', 'Times New Roman', Times, serif`;
        wrapTextLeft(finalCtx, jobText, jobX, jobY, jobMaxWidth, jobFontSize * 1.3, 3);

        const companyTopPercent = 57.8;
        const companyLeftPercent = 72.4;
        
        const companyX = 1280 * (companyLeftPercent / 100);
        const companyY = 760 * (companyTopPercent / 100);
        const companyMaxWidth = 1280 * 0.28;
        
        const companyText = companyInput.value.trim() || 'Your Institution';
        const companyFontSize = calculateDynamicFontSize(companyText, 22);
        finalCtx.font = `600 ${companyFontSize}px 'Georgia', 'Times New Roman', Times, serif`;
        wrapTextLeft(finalCtx, companyText, companyX, companyY, companyMaxWidth, companyFontSize * 1.3, 3);

        const downloadedImageUrl = finalCanvas.toDataURL("image/png");
        
        const link = document.createElement("a");
        link.download = "eduhack-ai-4-badge.png";
        link.href = downloadedImageUrl;
        link.click();
    };
    
    frameImg.onerror = function() {
        alert('Error loading frame.jpg. Make sure the file is in the same folder.');
    };
    
    frameImg.src = 'frame.jpg';
});

function wrapTextLeft(ctx, text, x, y, maxWidth, lineHeight, maxLines) {
    const words = text.split(' ');
    let lines = [];
    let currentLine = '';
    
    for (let i = 0; i < words.length; i++) {
        const testLine = currentLine + (currentLine ? ' ' : '') + words[i];
        const metrics = ctx.measureText(testLine);
        
        if (metrics.width > maxWidth && currentLine !== '') {
            lines.push(currentLine);
            currentLine = words[i];
            
            if (lines.length >= maxLines - 1) {
                const remaining = words.slice(i + 1);
                if (remaining.length > 0) {
                    currentLine += ' ' + remaining.join(' ');
                    if (ctx.measureText(currentLine).width > maxWidth) {
                        currentLine = currentLine.substring(0, currentLine.length - 3) + '...';
                    }
                }
                lines.push(currentLine);
                break;
            }
        } else {
            currentLine = testLine;
        }
    }
    
    if (lines.length < maxLines && currentLine) {
        lines.push(currentLine);
    }
    
    for (let i = 0; i < lines.length; i++) {
        ctx.fillText(lines[i], x, y + (i * lineHeight));
    }
}
</script>

</body>
</html>
